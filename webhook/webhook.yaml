apiVersion: webhookconfig.keptn.sh/v1alpha1
kind: WebhookConfig
metadata:
  name: webhook-configuration
spec:
  webhooks:
    - type: sh.keptn.event.test.triggered
      requests:
        - "curl --header 'Content-Type: application/json' --request POST --data
          '{\"data\":{\"project\":\"{{.data.project}}\",\"service\":\"{{.data.s\
          ervice}}\",\"stage\":\"{{.data.stage}}\"},\"shkeptncontext\":\"{{.shk\
          eptncontext}}\",\"id\":\"{{.id}}\",\"type\":\"{{.type}}\"}'
          http://34.215.238.225:8080/runtask"
      subscriptionID: d3f7f627-592d-4eee-81a6-cfd17610c5c6
      sendFinished: false
    - type: sh.keptn.event.deployment.triggered
      requests:
        - "curl --header 'Content-Type: application/json' --request POST --data
          '{\"data\":{\"project\":\"{{.data.project}}\",\"service\":\"{{.data.s\
          ervice}}\",\"stage\":\"{{.data.stage}}\"},\"shkeptncontext\":\"{{.shk\
          eptncontext}}\",\"id\":\"{{.id}}\",\"type\":\"{{.type}}\"}'
          http://34.215.238.225:8080/runtask"
      subscriptionID: 8add2e8a-d8de-4130-b85b-64611c0b04aa
      sendFinished: false
    - type: sh.keptn.event.notify.triggered
      requests:
        - curl --request POST --data
          '{"project":"{{.data.project}}","service":"{{.data.service}}","stage":"{{.data.stage}}","type":"{{.type}}","jiraKey":"{{.data.release.jiraKey}}","jiraSummary":"{{.data.release.jiraSummary}}","jiraUrl":"{{.data.release.jiraUrl}}"}'
          https://webhook.site/2be34b4b-8a90-47cd-ba9f-a3e237e90765
      subscriptionID: 38588eac-f2c6-45b3-880b-316f578d1d1f
      sendFinished: true
    - type: sh.keptn.event.notify.triggered
      requests:
        - "curl --request POST --data 'payload={  \"blocks\":
          [    {      \"type\" : \"section\",      \"text\" : {        \"type\":
          \"mrkdwn\",        \"text\" : \"New JIRA ticket
          {{.data.release.jiraKey}} to Deploy Code
          Created\"      }    },    {      \"type\" : \"section\",      \"text\"
          : {        \"type\": \"mrkdwn\",        \"text\" : \"*Project:*
          {{.data.project}}\\n*Service:* {{.data.service}}\\n*Stage:*
          {{.data.stage}}\\n*Type:* {{.type}}\\n*jiraSummary*:
          {{.data.release.jiraSummary}}\\n*jiraUrl*:
          {{.data.release.jiraUrl}}\\n*Bridge:*
          {{.env.secret_slackwebhook_bridgeUrl}}/trace/{{.shkeptncontext}}\"      \
          }    }  ]}'
          https://hooks.slack.com/services/{{.env.secret_slackwebhook_token}}"
      envFrom:
        - name: secret_slackwebhook_token
          secretRef:
            name: slack-webhook
            key: token
        - name: secret_slackwebhook_bridgeUrl
          secretRef:
            name: slack-webhook
            key: bridgeUrl
      subscriptionID: e682f6c2-eaf8-4ede-a0fa-e5aa0bfb0993
      sendFinished: true
    - type: sh.keptn.event.test.triggered
      requests:
        - "curl --header 'Authorization: token
          {{.env.secret_githubsecret_GITHUBTOKEN}}' --request POST --data
          '{\"event_type\":\"test\",\"client_payload\":{\"type\":\"{{.type}}\",\
          \"project\":\"{{.data.project}}\",\"service\":\"{{.data.service}}\",\
          \"stage\":\"{{.data.stage}}\",\"shkeptncontext\":\"{{.shkeptncontext}}\
          \",\"id\":\"{{.id}}\"}}'
          https://api.github.com/repos/dt-robertjahn/rob00334-release-demo/disp\
          atches"
      envFrom:
        - name: secret_githubsecret_GITHUBTOKEN
          secretRef:
            name: github-secret
            key: GITHUBTOKEN
      subscriptionID: 84c6e30d-e400-4ef2-bc9e-6b1d0a0f548c
      sendFinished: false
    - type: sh.keptn.event.updateissue.triggered
      requests:
        - "curl --header 'Content-type: application/json' --request POST --data
          '{\"jiraKey\":\"{{.data.release.jiraKey}}\",\"jiraMessage\":\"SLO
          Evaluation for Project: {{.data.project}} Stage: {{.data.stage}}
          Service:
          {{.data.service}}\",\"result\":\"{{.data.result}}\",\"bridge\":\"{{.e\
          nv.secret_bridge_url}}/evaluation/{{.shkeptncontext}}/{{.data.stage}}\
          \"}'
          https://automation.atlassian.com/pro/hooks/9be53cf516a9e3e0af08d3bd0c\
          c215d77c0b985e"
      envFrom:
        - name: secret_bridge_url
          secretRef:
            name: bridge
            key: url
      subscriptionID: 5d9c0397-7e29-4a24-bdf2-dbcd2c307600
      sendFinished: true
    - type: sh.keptn.event.deployment.triggered
      requests:
        - "curl --header 'Content-Type: application/json' --request POST --data
          '{\"type\":\"{{.type}}\",\"project\":\"{{.data.project}}\",\"service\
          \":\"{{.data.service}}\",\"stage\":\"{{.data.stage}}\",\"shkeptnconte\
          xt\":\"{{.shkeptncontext}}\",\"id\":\"{{.id}}\"}'
          https://{{.env.secret_jfrog_WEBHOOKURL}}"
      envFrom:
        - name: secret_jfrog_WEBHOOKURL
          secretRef:
            name: jfrog
            key: WEBHOOKURL
      subscriptionID: cbc3e38b-9bcb-4c26-ad0e-a353b174bd4b
      sendFinished: false
